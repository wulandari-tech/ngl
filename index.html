<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Kode</title>
    <style>
        /* ... CSS dari jawaban sebelumnya ... */
         #container-file{
          display: flex;
          flex-direction: column; /* Kontainer akan tersusun ke bawah */
          gap: 20px; /* Jarak antar kontainer */
        }
        .kontainer-file{
          border: 1px solid #ddd;
          padding: 15px;
          background-color: #fff;
          border-radius: 5px;
          overflow-x: auto; /* Tambahkan scroll horizontal jika kode terlalu panjang */
          /* Untuk posisi tombol copy */
        }
        .file-link{
          margin-bottom: 15px;
          padding: 10px;
          font-family: monospace; /* Font monospace untuk kode */
        }
    </style>
</head>
<body>
    <h1>Kumpulan Kode</h1>

    <div id="container-utama">
        <!-- Kontainer kode akan ditambahkan di sini -->
    </div>

    <h1>Kumpulan File</h1>
    <div id="container-file">
        </div>

    <script>
        // --- Bagian Kode (tidak berubah) ---
        function buatKontainerKode(kode) {
            const containerUtama = document.getElementById('container-utama');
            const kontainerKode = document.createElement('div');
            kontainerKode.classList.add('kontainer-kode');

            const pre = document.createElement('pre');
            pre.textContent = kode;
            kontainerKode.appendChild(pre);


            const tombolCopy = document.createElement('button');
            tombolCopy.textContent = 'Copy';
            tombolCopy.classList.add('tombol-copy');
            tombolCopy.addEventListener('click', () => {
                navigator.clipboard.writeText(kode).then(() => {
                   alert('Kode berhasil disalin!');
                }).catch(err => {
                    console.error('Gagal menyalin:', err);
                });
            });
            kontainerKode.appendChild(tombolCopy);

            containerUtama.appendChild(kontainerKode);

        }

        // Fungsi untuk mengambil data dari server
        async function ambilDataKode() {
            try {
                const response = await fetch('/api/kode'); // Sesuaikan dengan endpoint API Anda
                if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Urutkan data berdasarkan timestamp, terbaru di atas
                data.sort((a, b) => b.timestamp - a.timestamp);


                data.forEach(item => {
                    buatKontainerKode(item.kode);
                });
            } catch (error) {
                console.error('Gagal mengambil data:', error);
            }
        }
      document.addEventListener('DOMContentLoaded', ambilDataKode);

        // --- Bagian File (berubah) ---

        function buatKontainerFile(id, originalname) {
          const containerFile = document.getElementById('container-file');
          const kontainerFile = document.createElement('div');
          kontainerFile.classList.add('kontainer-file');

          const fileLink = document.createElement('a');
          fileLink.textContent = originalname;
          fileLink.href = '#';  // Placeholder, akan diisi nanti
          fileLink.classList.add('file-link');
          fileLink.addEventListener('click', async (event) => {
            event.preventDefault(); // Mencegah perilaku default link

            try{
              const response = await fetch(`/api/files/${id}`);
              if(!response.ok){
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              const fileData = await response.json();

              // Buat link download dari base64
              const link = document.createElement('a');
              link.href = fileData.file; // Data base64 langsung
              link.download = fileData.originalname; // Nama file saat didownload
              link.click();


            }catch(error){
              console.error('Gagal mendownload file:', error);
              alert('Terjadi kesalahan saat mendownload file.');
            }
          });
          kontainerFile.appendChild(fileLink);
          containerFile.appendChild(kontainerFile);
        }



        async function ambilDataFile() {
          try {
                const response = await fetch('/api/files'); // Sesuaikan dengan endpoint API Anda
                if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Urutkan data berdasarkan timestamp, terbaru di atas
                data.sort((a, b) => b.timestamp - a.timestamp);


                data.forEach(item => {
                    buatKontainerFile(item.id, item.originalname);
                });
            } catch (error) {
                console.error('Gagal mengambil data:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', ambilDataFile);

    </script>
</body>
</html>
